<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>路由规则 - Dubbo 2.7.8</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u8def\u7531\u89c4\u5219";
    var mkdocs_page_input_path = "user/demos/routing-rule.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Dubbo 2.7.8</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">用户手册</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">入门</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/background/">背景</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/background/">需求</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/architecture/">架构</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/usage/">用法</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../quick-start/">快速启动</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dependencies/">依赖</a>
                </li>
                <li class="">
                    
    <a class="" href="../../maturity/">成熟度</a>
                </li>
                <li class="">
                    
    <span class="caption-text">配置</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/xml/">XML 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/api/">API 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/annotation/">Annotation 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/annotation/">动态配置中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/configuration-load-process/">配置加载流程</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/environment-variables.md">自动加载环境变量</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">示例</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../preflight-check/">启动时检查</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../fault-tolerent-strategy/">集群容错</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../loadbalance/">负载均衡</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../thread-model/">线程模型</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../explicit-target/">直连提供者</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../subscribe-only/">只订阅</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../registry-only/">只注册</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../static-service/">静态服务</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../multi-protocols/">多协议</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../multi-registry/">多注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../service-group/">服务分组</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../multi-versions/">多版本</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../group-merger/">分组聚合</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../parameter-validation/">参数验证</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../result-cache/">结果缓存</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../generic-reference/">泛化引用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../generic-service/">泛化实现</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../echo-service/">回声测试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../context/">上下文信息</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../attachment/">隐式参数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../async-call/">异步调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../async-execute-on-provider/">服务端异步</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../local-call/">本地调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../callback-parameter/">参数回调</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../events-notify/">事件通知</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../local-stub/">本地存根</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../local-mock/">本地伪装</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../delay-publish/">延迟暴露</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../concurrency-control/">并发控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../config-connection.md">连接控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../lazy-connect/">延迟连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../stickiness/">粘滞连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../token-authorization/">令牌验证</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">路由规则</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#routing-rules">Routing Rules</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#write-routing-rules">Write Routing Rules</a></li>
        
            <li><a class="toctree-l5" href="#conditional-routing-rules">Conditional routing rules</a></li>
        
            <li><a class="toctree-l5" href="#script-routing-rules">Script routing rules</a></li>
        
            <li><a class="toctree-l5" href="#tag-routing-rules">Tag routing rules</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../config-rule/">配置规则</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../service-downgrade/">服务降级</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../graceful-shutdown/">优雅停机</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../hostname-binding/">主机绑定</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../logger-strategy/">日志适配</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../accesslog/">访问日志</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../service-container/">服务容器</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../distributed-transaction/">分布式事务</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../dump/">线程栈自动dump</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../netty4/">Netty4</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../serialization/">Kryo和FST序列化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../simplify-registry-data.md">简化注册中心URL</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../api.md">API 参考手册</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">schema 配置参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-service/">dubbo:service</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-reference/">dubbo:reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-protocol/">dubbo:protocol</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-registry/">dubbo:registry</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-monitor/">dubbo:monitor</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-application/">dubbo:application</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-module/">dubbo:module</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-provider/">dubbo:provider</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-consumer/">dubbo:consumer</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-method/">dubbo:method</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-argument/">dubbo:argument</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-parameter/">dubbo:parameter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-config-center/">dubbo:config-center</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">协议参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/dubbo/">dubbo://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/rmi/">rmi://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/hessian/">hessian://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/http/">http://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/thrift/">thrift://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/rest/">rest://</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">注册中心参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/multicast/">Multicast 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/zookeeper/">Zookeeper 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/redis/">Redis 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/simple/">Simple 注册中心</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">元数据中心参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/metadata/metadata-redis.md">Redis 元数据中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/metadata-zookeeper.md">Zookeeper 元数据中心</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../references/telnet/">telnet 命令参考手册</a>
                </li>
                <li class="">
                    
    <a class="" href="../../references/qos/">在线运维命令-QOS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../references/maven/">maven 插件参考手册</a>
                </li>
                <li class="">
                    
    <a class="" href="../../best-practice/">服务化最佳实践</a>
                </li>
                <li class="">
                    
    <a class="" href="../../recommend/">推荐用法</a>
                </li>
                <li class="">
                    
    <a class="" href="../../capacity-plan/">容量规划</a>
                </li>
                <li class="">
                    
    <a class="" href="../../perf-test/">性能测试报告</a>
                </li>
                <li class="">
                    
    <a class="" href="../../covergence.md">测试覆盖率报告</a>
                </li>
                <li class="">
                    
    <span class="caption-text">版本与升级</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../version-270.md">2.7.x升级步骤及注意事项</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">开发手册</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../dev/build/">源码构建</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/design/">框架设计</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/SPI/">扩展点加载</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/implementation/">实现细节</a>
                </li>
                <li class="">
                    
    <span class="caption-text">SPI 扩展实现</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/protocol/">协议扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/filter/">调用拦截扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/invoker-listener/">引用监听扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/exporter-listener/">暴露监听扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/cluster/">集群扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/router/">路由扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/load-balance/">负载均衡扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/merger/">合并结果扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/registry/">注册中心扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/monitor/">监控中心扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/extension-factory/">扩展点加载扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/proxy-factory/">动态代理扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/compiler/">编译器扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/dispatcher/">消息派发扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/threadpool/">线程池扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/serialize/">序列化扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/remoting/">网络传输扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/exchanger/">信息交换扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/networker/">组网扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/telnet-handler/">Telnet 命令扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/status-checker/">状态检查扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/container/">容器扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/page/">页面扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/cache/">缓存扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/validation/">验证扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/logger-adapter/">日志适配扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/impls/config-center/">配置中心</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/contract/">公共契约</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/coding/">编码约定</a>
                </li>
                <li class="">
                    
    <span class="caption-text">设计原则</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/principals/code-detail/">魔鬼在细节</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/principals/general-knowledge/">一些设计上的基本常识</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/principals/expansibility/">谈谈扩充式扩展与增量式扩展</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/principals/configuration/">配置设计</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/principals/robustness/">设计实现的健壮性</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/principals/dummy/">防痴呆设计</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../dev/principals/extension/">扩展点重构</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/release/">编码约定</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/contribution/">编码约定</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/checklist/">编码约定</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/code-smell/">编码约定</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/TCK/">编码约定</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">管理者文档</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../dev/introduction/">Dubbo Admin介绍</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/serviceSearch.md">服务搜索和详情</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/serviceGovernance.md">服务治理</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/serviceTest.md">服务测试</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Dubbo 2.7.8</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>示例 &raquo;</li>
        
      
        
          <li>用户手册 &raquo;</li>
        
      
    
    <li>路由规则</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/apache/dubbo-website/edit/master/docs/user/demos/routing-rule.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="routing-rules">Routing Rules</h1>
<p>The routing rules [^1] determine the target server of one service call. It has two kinds of routing rules: conditional routing rules and script routing rules. It also support extension[^2].</p>
<h2 id="write-routing-rules">Write Routing Rules</h2>
<p>Writing routing rules to the registry is usually done by the monitoring center or the console page.</p>
<pre><code class="java">RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();
Registry registry = registryFactory.getRegistry(URL.valueOf(&quot;zookeeper://10.20.153.10:2181&quot;));
registry.register(URL.valueOf(&quot;route://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=&quot; + URL.encode(&quot;host = 10.20.153.10 =&gt; host = 10.20.153.11&quot;)));
</code></pre>

<p>其中：</p>
<ul>
<li><code>route://</code> It indicates the type of routing rules, supports routing rules and script routing rules, and can be extended. <strong>Required</strong>。</li>
<li><code>0.0.0.0</code> It indicates that all IP addresses are valid. If you want to take effect for only one IP address, fill in the IP address. <strong>Required</strong>。</li>
<li><code>com.foo.BarService</code> It indicates that the specified service is effective. <strong>Required</strong>。</li>
<li><code>group=foo</code> It indicates that the specified service in specified group is effective. When absent, the specified service which dosen't configure group is effective.</li>
<li><code>version=1.0</code>It indicates that the specified service in specified version is effective. When absent, the specified service which dosen't configure version is effective.</li>
<li><code>category=routers</code> It indicates that the data is a dynamic configuration type. <strong>Required</strong>。</li>
<li><code>dynamic=false</code> It indicates that it is persistent data. When the registrant exits, the data is still stored in the registry. <strong>Required</strong>。</li>
<li><code>enabled=true</code> It indicates whether this routing rules is effective. Option, and default effective.</li>
<li><code>force=false</code> It indicates whether it is forced to be executed when the routing result is null. If it is not enforced, the route will be automatically invalidated. Option, and default <code>false</code>.</li>
<li><code>runtime=false</code> It indicates whether to execute routing rules at every call. If not, the result is only pre-executed and cached when the provider's address list changes.  It will get routing result from cache when the service is invoked. If you use parameter routing, you must to configure it as <code>true</code>. Be careful that the configuration will affect the performance. Option, and default <code>false</code>.</li>
<li><code>priority=1</code> The priority of the routing rules. it is used for sorting, the greater the priority, the more front execution. Option, and default <code>0</code>。</li>
<li><code>rule=URL.encode("host = 10.20.153.10 =&gt; host = 10.20.153.11")</code> It indicates the content of routing rule，<strong>Required</strong>。</li>
</ul>
<h2 id="conditional-routing-rules">Conditional routing rules</h2>
<p>Routing rules based on conditional expressions, such as：<code>host = 10.20.153.10 =&gt; host = 10.20.153.11</code></p>
<h3 id="rules">Rules：</h3>
<ul>
<li>The previous of <code>=&gt;</code> is matched condition for consumer. All parameters compare with URL of consumers. When the consumer meet the condition, it will continue to execute the behind filter rules for consumer.</li>
<li>After the <code>=&gt;</code> aims to filter the provider address list.  All the parameters are compared against the provider's URL, and consumer get only the filtered address list at finally.</li>
<li>If the previous condition for consumer is empty, it means all consumers can matched. such as : <code>=&gt; host != 10.20.153.11</code></li>
<li>If the filter condition for provider is empty, it means it is forbidden to visit. such as :<code>host = 10.20.153.10 =&gt;</code></li>
</ul>
<h3 id="expressions">Expressions：</h3>
<p>Parameter Support：</p>
<ul>
<li>Service call information, such as: method, argument etc. Parameter routing is currently not supported</li>
<li>URL field (On URL own), such as: protocol, host, port etc.</li>
<li>All parameters on the URL. such as: application, organization etc.</li>
</ul>
<p>Condition Support：</p>
<ul>
<li>Equal sign <code>=</code> indicates match. such as: <code>host = 10.20.153.10</code></li>
<li>Not equal sign <code>!=</code> indicates "does not match". such as: <code>host != 10.20.153.10</code>.</li>
</ul>
<p>Value Support：</p>
<ul>
<li>Separate multiple values with a comma <code>,</code> .  Such as：<code>host != 10.20.153.10,10.20.153.11</code></li>
<li>End with  <code>*</code> to indicate wildcard.  Such as： <code>host != 10.20.*</code></li>
<li>Start with <code>$</code> to indicate reference to consumer parameters. Such as: <code>host = $host</code></li>
</ul>
<h3 id="samples">Samples</h3>
<ol>
<li>
<p>Exclude pre-release machine：</p>
<p><code>=&gt; host != 172.22.3.91</code>
1. Whitelist [^3]：</p>
<p><code>host != 10.20.153.10,10.20.153.11 =&gt;</code>
2. Blacklist：</p>
<p><code>host = 10.20.153.10,10.20.153.11 =&gt;</code>
3. Service boarding application only expose part of the machine to prevent the entire cluster hanging up:</p>
<p><code>=&gt; host = 172.22.3.1*,172.22.3.2*</code>
4. Additional machines for important applications：</p>
<p><code>application != kylin =&gt; host != 172.22.3.95,172.22.3.96</code>
5. Read and write separation：</p>
<p><code>method = find*,list*,get*,is* =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96
method != find*,list*,get*,is* =&gt; host = 172.22.3.97,172.22.3.98</code></p>
</li>
<li>
<p>Separation of Front and Background Application：</p>
<p><code>application = bops =&gt; host = 172.22.3.91,172.22.3.92,172.22.3.93
application != bops =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96</code></p>
</li>
<li>
<p>Isolate different network segments：</p>
<p><code>host != 172.22.3.* =&gt; host != 172.22.3.*</code></p>
</li>
<li>
<p>Providers and consumers deployed in the same cluster, the machine only visit the local service：</p>
<p><code>=&gt; host = $host</code></p>
</li>
</ol>
<h2 id="script-routing-rules">Script routing rules</h2>
<p>Script routing rules [^4] support all scripts of JDK script engine. such as: javascript, jruby, groovy, etc. Configure the script type by <code>type=javascript</code>, the default is javascript.</p>
<pre><code>&quot;script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=&quot; + URL.encode(&quot;(function route(invokers) { ... } (invokers))&quot;)
</code></pre>

<p>Routing rules that base on script engine is as follow：</p>
<pre><code class="javascript">(function route(invokers) {
    var result = new java.util.ArrayList(invokers.size());
    for (i = 0; i &lt; invokers.size(); i ++) {
        if (&quot;10.20.153.10&quot;.equals(invokers.get(i).getUrl().getHost())) {
            result.add(invokers.get(i));
        }
    }
    return result;
} (invokers)); // Indicates that the method is executed immediately
</code></pre>

<h2 id="tag-routing-rules">Tag routing rules</h2>
<p>Tag routing rules [^5] , when the application configures the <code>TagRouter</code> , a tagged dubbo invocation can intelligently route to the service provider which has the corresponding tag.</p>
<h3 id="provider">Provider</h3>
<ol>
<li>configure TagRouter for the application</li>
</ol>
<pre><code class="Java">@Bean
public ApplicationConfig applicationConfig() {
    ApplicationConfig applicationConfig = new ApplicationConfig();
    applicationConfig.setName(&quot;provider-book&quot;);
    applicationConfig.setQosEnable(false);
    // instruct tag router
    Map&lt;String,String&gt; parameters = new HashMap&lt;&gt;();
    parameters.put(Constants.ROUTER_KEY, &quot;tag&quot;);
    applicationConfig.setParameters(parameters);
    return applicationConfig;
}
</code></pre>

<ol>
<li>configure specfic tag for the provider</li>
</ol>
<pre><code class="java">@Bean
public ProviderConfig providerConfig(){
    ProviderConfig providerConfig = new ProviderConfig();
    providerConfig.setTag(&quot;red&quot;);
    return providerConfig;
}
</code></pre>

<p>The application which configures no tag will be considered as the default application, and these default apps will be treated as downgrades when the invocation fails to match the provider.</p>
<h3 id="consumer">Consumer</h3>
<pre><code class="Java">RpcContext.getContext().setAttachment(Constants.REQUEST_TAG_KEY,&quot;red&quot;);
</code></pre>

<p>The scope of the <code>request.tag</code> is for each invocation, using the attachment to pass the request tag. Note that the value stored in the attachment will be passed continuously in a complete remote invocation, thanks to this feature, we only need to set the tag at the beginning of a invocation. </p>
<blockquote>
<p>Currently, only <strong>hardcoding</strong> is supported to set requestTag. Note that RpcContext is thread-bound, elegantly using the TagRouter feature, it is recommended to set the request tag via a servlet filter (in the web environment) or a custom dubbo SPI filter.</p>
</blockquote>
<h3 id="rules_1">Rules:</h3>
<ol>
<li>
<p><code>request.tag=red</code> will firstlt choose the provider which configures as <code>tag=red</code>. If there is no service corresponding to the request tag in the cluster, it will downgrade to <code>tag=null</code> provider, seen as default provider。</p>
</li>
<li>
<p>when <code>request.tag=null</code>, only <code>tag=null</code>  provider will be matched. Even if there are services available in the cluster, the tags do not match, they cannot be called. This is different from rule 1. Tagged invocation can be downgraded to untagged services, but invocations that do not carry tags/carry other types of tags can never be accessed other tag services.</p>
</li>
</ol>
<p>[^1]: Support since <code>2.2.0</code> <br />
[^2]: Routing Rules Extension Point: <a href="http://dubbo.apache.org/en-us/docs/dev/impls/router.html">Route Extension</a> <br />
[^3]: Note: A service can only have one whitelist rule, otherwise the two rules will be filtered out.<br />
[^4]: Note: Scripts have no sandbox constraints, can execute arbitrary code, and poses a backdoor risk.<br />
[^5]: Support since <code>2.7.0</code></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../config-rule/" class="btn btn-neutral float-right" title="配置规则">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../token-authorization/" class="btn btn-neutral" title="令牌验证"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/apache/dubbo-website/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../token-authorization/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../config-rule/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
