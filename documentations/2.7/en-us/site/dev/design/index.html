<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Framework Design - Dubbo</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Framework Design";
    var mkdocs_page_input_path = "dev/design.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Dubbo</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">用户手册</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">入门</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/preface/background.md">背景</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/preface/background.md">需求</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/preface/architecture.md">架构</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/preface/usage.md">用法</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../zh-cn/user/quick-start.md">快速启动</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zh-cn/user/dependencies.md">依赖</a>
                </li>
                <li class="">
                    
    <a class="" href="../../zh-cn/user/maturity.md">成熟度</a>
                </li>
                <li class="">
                    
    <span class="caption-text">配置</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/configuration/xml.md">XML 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/configuration/api.md">API 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/configuration/annotation.md">Annotation 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/configuration/annotation.md">动态配置中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/configuration/configuration-load-process.md">配置加载流程</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/configuration/environment-variables.md">自动加载环境变量</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">示例</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/preflight-check.md">启动时检查</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/fault-tolerent-strategy.md">集群容错</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/loadbalance.md">负载均衡</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/thread-model.md">线程模型</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/explicit-target.md">直连提供者</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/subscribe-only.md">只订阅</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/registry-only.md">只注册</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/static-service.md">静态服务</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/multi-protocols.md">多协议</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/multi-registry.md">多注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/service-group.md">服务分组</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/multi-versions.md">多版本</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/group-merger.md">分组聚合</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/parameter-validation.md">参数验证</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/result-cache.md">结果缓存</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/generic-reference.md">泛化引用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/generic-service.md">泛化实现</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/echo-service.md">回声测试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/context.md">上下文信息</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/attachment.md">隐式参数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/async-call.md">异步调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/async-execute-on-provider.md">服务端异步</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/local-call.md">本地调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/callback-parameter.md">参数回调</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/events-notify.md">事件通知</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/local-stub.md">本地存根</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/local-mock.md">本地伪装</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/delay-publish.md">延迟暴露</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/concurrency-control.md">并发控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/config-connection.md">连接控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/lazy-connect.md">延迟连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/stickiness.md">粘滞连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/token-authorization.md">令牌验证</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/routing-rule.md">路由规则</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/config-rule.md">配置规则</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/service-downgrade.md">服务降级</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/graceful-shutdown.md">优雅停机</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/hostname-binding.md">主机绑定</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/logger-strategy.md">日志适配</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/accesslog.md">访问日志</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/service-container.md">服务容器</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../zh-cn/user/demos/reference-config-cache.md">Reference Config 缓存</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Dubbo</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Framework Design</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="framework-design">Framework Design</h1>
<h2 id="overall-design">Overall design</h2>
<p><img alt="/dev-guide/images/dubbo-framework.jpg" src="../sources/images/dubbo-framework.jpg" /></p>
<p>Image description:</p>
<ul>
<li>Left area with light blue background shows service consumer interfaces, Right area with light green background shows service provider interfaces, center area shows both side interfaces.</li>
<li>The image is divided into 10 layers from the bottom to the top, and the layers are one-way dependence. The black arrow on the right represents the dependency between layers, and each layer can be stripped from the upper layer to be reused, the Service and Config layers are API, and the other layers are SPI.</li>
<li>Green boxes are extension interfaces, blue boxes are implementation classes, image only shows implementation class of associated layers.</li>
<li>The blue dashed line is the initialization process, which is assembly chain when starting, red line for the method call process, which is calling chain when running, purple triangle arrow is inherited, can treat subclass as the same node of parent class, text of lines are the method invocation.</li>
</ul>
<h2 id="layer-description">Layer description</h2>
<ul>
<li><strong>config layer</strong>: external config interface, <code>ServiceConfig</code> and <code>ReferenceConfig</code> is the center of the layer, you can directly initialize config class, also can generate config class by spring.</li>
<li><strong>proxy layer</strong>: transparent proxy of service interface, generate client Stub of service and server Skeletion of service, <code>ServiceProxy</code> is the center, extension interface is <code>ProxyFactory</code>.</li>
<li><strong>registry layer</strong>: encapsulation of service registry and discovery, service URL is the center, extension interfaces are <code>RegistryFactory</code>, <code>Registry</code> and <code>RegistryService</code>.</li>
<li><strong>cluster layer</strong>: encapsulation of cluster of muliple providers and load balance, and bridging registration center, <code>Invoker</code> is the center, extension interfaces are <code>Cluster</code>, <code>Directory</code>, <code>Router</code>, <code>LoadBalance</code>.</li>
<li><strong>monitor layer</strong>: monitor of RPC call times and call execute time, <code>Statistics</code> is the center, extension interface are <code>MonitorFactory</code>, <code>Monitor</code>, <code>MonitorService</code></li>
<li><strong>protocol layer</strong>: encapsulation of RPC, <code>Invocation</code> and <code>Result</code> are the center, extension interfaces are <code>Protocol</code>, <code>Invoker</code>, <code>Exporter</code></li>
<li><strong>exchange layer</strong>: encapsulation of request and response, synchronous transfer asynchronous, <code>Request</code> and <code>Response</code> are the center, extension interfaces are <code>Exchanger</code>, <code>ExchangeChannel</code>, <code>ExchangeClient</code>, <code>ExchangeServer</code></li>
<li><strong>transport layer</strong>: abstraction of mina and netty, <code>Message</code> is the center, extension interfaces are <code>Channel</code>, <code>Transporter</code>, <code>Client</code>, <code>Server</code>, <code>Codec</code></li>
<li><strong>serialize layer</strong>: reusable tools, extension interfaces are <code>Serialization</code>, <code>ObjectInput</code>, <code>ObjectOutput</code>, <code>ThreadPool</code></li>
</ul>
<h2 id="relationship-description">Relationship description</h2>
<ul>
<li>In RPC, Protocol is the core layer, it means that you can complete RPC calling by Protocol + Invoker + Exporter, then filter at the main process of Invoker.</li>
<li>Consumer and Provider are abstraction concepts, just want you have a more intuitive understanding of which classes belong to the client and server side, the reason not use Client and Server is that Dubbo uses Provider, Consumer, Registry, Monitor divide logical topology node in many scenes, keep the concept of unity.</li>
<li>Cluster is external concept, the purpose of Cluster is that make various Invoker disguise to one Invoker, so that we just pay attention to the Invoker in Protocol layer, adding Cluster or removing Cluster will not affect other layers, because we don't need Cluster when only have one provider.</li>
<li>The Proxy layer encapsulates the transparent proxy for all interfaces, and in other layers with Invoker as the center, turn Invoker into interface, or turn interface implementation into Invoker by Proxy only when exposuring to user. RPC still work even removing Proxy layer, but not so transparent, making remote service calling don't look like local service calling.</li>
<li>Remoting is the implemetation of Dubbo protocols, you can remove Remoting if choosing RMI. The Remoting is divided into Transport layer and Exchange layer, Transport layer is responsible for one-way message transmission, it's abstraction of Mina, Netty, Grizzly, it also can extend UDP transmission. The Exchange layer encapsulates the Request-Response semantics over the transport layer.</li>
<li>Actually Registry and Monitor are not at the same layer, they are independent nodes, draw them together by layer just for global view.</li>
</ul>
<h2 id="modules-packaging">Modules packaging</h2>
<p><img alt="/dev-guide/images/dubbo-modules.jpg" src="../sources/images/dubbo-modules.jpg" /></p>
<p>Modules description:</p>
<ul>
<li><strong>dubbo-common module</strong>: includes Util classes and common modules.</li>
<li><strong>dubbo-remoting module</strong>: is Dubbo protocol implementation, no need to use this module if using RMI for RPC.</li>
<li><strong>dubbo-rpc module</strong>: abstraction of various protocols, and dynamic proxy, only one to one call, not concerned with the management of cluster.</li>
<li><strong>dubbo-cluster module</strong>: disguise many service providers as one provider, including load balancing, fault tolerance, routing, etc. the address list of clusters can be either static or send by registry.</li>
<li><strong>dubbo-registry module</strong>: Based on the cluster of registry send address and the abstraction of various registry centers.</li>
<li><strong>dubbo-monitor module</strong>: statistics of service call times, call time, call chain tracked services.</li>
<li><strong>dubbo-config module</strong>: is Dubbo external API, users use Dubbo by Config, hide Dubbo details.</li>
<li><strong>dubbo-container module</strong>: is a Standlone container, just use Main method to load Spring, because usually service no need Tomcat/JBoss features.</li>
</ul>
<p>Package dividing according to the layer structure, and the difference with layer dividing:</p>
<ul>
<li>container is service container, for service running deployment, not showed in the image.</li>
<li>protocol layer and proxy layer are placed in RPC module, they are the core of RPC module, you can use these 2 layers complete RPC call when only have 1 provider.</li>
<li>transport layer and exchange layer are placed in remoting module, for RPC call base comminucation.</li>
<li>serialize layer is placed in common module, for reuse.</li>
</ul>
<h2 id="dependence-relationship">Dependence relationship</h2>
<p><img alt="/dev-guide/images/dubbo-relation.jpg" src="../sources/images/dubbo-relation.jpg" /></p>
<p>Image description:</p>
<ul>
<li>The boxes in image, Protocol, Cluster, Proxy, Service, Container, Registry, Monitor represent layer or module, the blues mean interactive with business, the greens mean only internal interactive with Dubbo.</li>
<li>The backgroud boxes in image, Consumer, Provider, Registry, Monitor represent deployment logical topology node.</li>
<li>The blue dashed line in the image is called for initialization, the red dashed line is called asynchronously for runtime, and the red line is called synchronously for runtime.</li>
<li>The image only includes RPC layer, don't includes Remoting layer, the whole Remoting hides in Protocol layer.</li>
</ul>
<h2 id="call-chain">Call chain</h2>
<p>Expand the red call chain of the overall design map:</p>
<p><img alt="/dev-guide/images/dubbo-extension.jpg" src="../sources/images/dubbo-extension.jpg" /></p>
<h2 id="expose-service-sequence">Expose service sequence</h2>
<p>Expand the initialization chain of service provider exposes service which at the left of the overall design map, the sequence diagram shows below:</p>
<p><img alt="/dev-guide/images/dubbo-export.jpg" src="../sources/images/dubbo-export.jpg" /></p>
<h2 id="reference-service-sequence">Reference service sequence</h2>
<p>Expand the initialization chain of service consumer references service which at the right of the overall design map, the sequence diagram shows below:</p>
<p><img alt="/dev-guide/images/dubbo-refer.jpg" src="../sources/images/dubbo-refer.jpg" /></p>
<h2 id="domain-model">Domain model</h2>
<p>The core domain models of Dubbo:</p>
<ul>
<li>Protocol is service domain, it is the main function entrance of Invoker exposure and reference, it is responsible for the life cycle management of Invoker.</li>
<li>Invoker is entity domain, it is the core model of Dubbo, all the other models are disturbed, or converted to it, it represents an executable, you can call it by calling invoke, it can be a local implementation, a remote implementation, or a cluster implementation.</li>
<li>Invocation is session domain, it holds variables in the calling process, such as the method name, the parameters, and so on.</li>
</ul>
<h2 id="base-design-principle">Base design principle</h2>
<ul>
<li>Use Microkernel + Plugin design pattern，Microkernel only responsible for assembly Plugin, the functions of Dubbo are implemented by extension points, it means that all functions of Dubbo can be replaced by self defined extension by user.</li>
<li>Use URL to be the startdard format of config information, all extension points transfer config information by URL.</li>
</ul>
<p>More design principles refer to: <a href="../principals/introduction/">Framework design principle</a></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
