<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>"Fool-proof" design - Dubbo 3.0.0</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\"Fool-proof\" design";
    var mkdocs_page_input_path = "dev/principals/dummy.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Dubbo 3.0.0</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">用户手册</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">入门</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/preface/background/">背景</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/preface/background/">需求</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/preface/architecture/">架构</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/preface/usage/">用法</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/quick-start/">快速启动</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/dependencies/">依赖</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/maturity/">成熟度</a>
                </li>
                <li class="">
                    
    <span class="caption-text">配置</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/configuration/xml/">XML 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/configuration/api/">API 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/configuration/annotation/">Annotation 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/configuration/annotation/">动态配置中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/configuration/configuration-load-process/">配置加载流程</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/configuration/environment-variables.md">自动加载环境变量</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">示例</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/preflight-check/">启动时检查</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/fault-tolerent-strategy/">集群容错</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/loadbalance/">负载均衡</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/thread-model/">线程模型</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/explicit-target/">直连提供者</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/subscribe-only/">只订阅</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/registry-only/">只注册</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/static-service/">静态服务</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/multi-protocols/">多协议</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/multi-registry/">多注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/service-group/">服务分组</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/multi-versions/">多版本</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/group-merger/">分组聚合</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/parameter-validation/">参数验证</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/result-cache/">结果缓存</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/generic-reference/">泛化引用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/generic-service/">泛化实现</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/echo-service/">回声测试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/context/">上下文信息</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/attachment/">隐式参数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/async-call/">异步调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/async-execute-on-provider/">服务端异步</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/local-call/">本地调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/callback-parameter/">参数回调</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/events-notify/">事件通知</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/local-stub/">本地存根</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/local-mock/">本地伪装</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/delay-publish/">延迟暴露</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/concurrency-control/">并发控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/config-connection.md">连接控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/lazy-connect/">延迟连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/stickiness/">粘滞连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/token-authorization/">令牌验证</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/routing-rule/">路由规则</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/config-rule/">配置规则</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/service-downgrade/">服务降级</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/graceful-shutdown/">优雅停机</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/hostname-binding/">主机绑定</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/logger-strategy/">日志适配</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/accesslog/">访问日志</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/service-container/">服务容器</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/distributed-transaction/">分布式事务</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/dump/">线程栈自动dump</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/netty4/">Netty4</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/serialization/">Kryo和FST序列化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/simplify-registry-data.md">简化注册中心URL</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/demos/api.md">API 参考手册</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">schema 配置参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-service/">dubbo:service</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-reference/">dubbo:reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-protocol/">dubbo:protocol</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-registry/">dubbo:registry</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-monitor/">dubbo:monitor</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-application/">dubbo:application</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-module/">dubbo:module</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-provider/">dubbo:provider</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-consumer/">dubbo:consumer</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-method/">dubbo:method</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-argument/">dubbo:argument</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-parameter/">dubbo:parameter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/xml/dubbo-config-center/">dubbo:config-center</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">协议参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/protocol/dubbo/">dubbo://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/protocol/rmi/">rmi://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/protocol/hessian/">hessian://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/protocol/http/">http://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/protocol/thrift/">thrift://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/protocol/rest/">rest://</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">注册中心参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/registry/multicast/">Multicast 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/registry/zookeeper/">Zookeeper 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/registry/redis/">Redis 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/registry/simple/">Simple 注册中心</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">元数据中心参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/metadata/metadata-redis.md">Redis 元数据中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/references/registry/metadata-zookeeper.md">Zookeeper 元数据中心</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/references/telnet/">telnet 命令参考手册</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/references/qos/">在线运维命令-QOS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/references/maven/">maven 插件参考手册</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/best-practice/">服务化最佳实践</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/recommend/">推荐用法</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/capacity-plan/">容量规划</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/perf-test/">性能测试报告</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../user/covergence.md">测试覆盖率报告</a>
                </li>
                <li class="">
                    
    <span class="caption-text">版本与升级</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../../user/version-270.md">2.7.x升级步骤及注意事项</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">管理者文档</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../introduction/">Dubbo Admin介绍</a>
                </li>
                <li class="">
                    
    <a class="" href="../../serviceSearch.md">服务搜索和详情</a>
                </li>
                <li class="">
                    
    <a class="" href="../../serviceGovernance.md">服务治理</a>
                </li>
                <li class="">
                    
    <a class="" href="../../serviceTest.md">服务测试</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Dubbo 3.0.0</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
    
    <li>"Fool-proof" design</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="fool-proof-design">"Fool-proof" design</h1>
<blockquote>
<p>http://javatar.iteye.com/blog/804187</p>
</blockquote>
<p>Recently I was feeling stupid because I solved too many stupid problems. The service framework is becoming more widely used. Every day, I have to help the endpoint user to resolve problems. Gradually, it is found that most of the problems are configuration errors, or duplicated files or classes, or network failure. So I prepare to add some "fool-proof" design to the further version. It may be very simple, but it is still a little help for troubleshooting speed. I hope that I can throw a brick to attract jade, and everyone can help to come up with more preventive measures to share.</p>
<h2 id="check-for-duplicated-jars">Check for duplicated jars</h2>
<p>The most annoying problem is that, if we have several jars with different version number at the same time, there will be a problem. Imagine that, a new version of the Class A may invoke a old version of the Class B, it's related to the JVM loading order. The problem may encounter occasionally and hard to resolve. So the first, let's try to avoid it. For each jar package, pick a class that will be loaded, check it for duplication for example:</p>
<pre><code class="java">static {  
    Duplicate.checkDuplicate(Xxx.class);  
}  
</code></pre>

<p>Utility class for check duplication：</p>
<pre><code class="java">public final class Duplicate {  

    private Duplicate() {}  

    public static void checkDuplicate(Class cls) {  
        checkDuplicate(cls.getName().replace('.', '/') + &quot;.class&quot;);  
    }  

    public static void checkDuplicate(String path) {  
        try {  
            // search from ClassPath
            Enumeration urls = Thread.currentThread().getContextClassLoader().getResources(path);  
            Set files = new HashSet();  
            while (urls.hasMoreElements()) {  
                URL url = urls.nextElement();  
                if (url != null) {  
                    String file = url.getFile();  
                    if (file != null &amp;amp;&amp;amp; file.length() &amp;gt; 0) {  
                        files.add(file);  
                    }  
                }  
            }  
            // if there are more than one indicates duplication
            if (files.size() &amp;gt; 1) {  
                logger.error(&quot;Duplicate class &quot; + path + &quot; in &quot; + files.size() + &quot; jar &quot; + files);  
            }  
        } catch (Throwable e) { // safe guard
            logger.error(e.getMessage(), e);  
        }  
    }  

}  
</code></pre>

<h2 id="check-for-duplicate-configuration-files">Check for duplicate configuration files</h2>
<p>It is also a frequently encountered problem that the configuration file is loaded incorrectly. Users often complain that they have the right configuration but program says something is wrong. After some troubleshooting, found that the configuration file is not even loaded. Many products put a default configuration file under classpath, if there are several, usually the first one loaded by JVM is effective. In order not to be bothered by such problem, just like checking duplicate jars, add this:</p>
<pre><code class="java">Duplicate.checkDuplicate(&quot;xxx.properties&quot;); 
</code></pre>

<h2 id="check-for-optional-configuration">Check for optional configuration</h2>
<p>The required configuration is estimated to be checked by everyone, because without it the program may not even start. However, for some optional parameters, some checks should also be made. For example, the service framework allows the service consumers and service providers to be associated with the registry, and allows direct configuring the service provider address to point-to-point direct connect. At this time, the registry address is optional, but if there is no point-to-point direct connect configured, the registry center address must be matched, and this time you have to check accordingly.</p>
<h2 id="provide-error-message-with-a-solution-if-possible">Provide error message with a solution if possible</h2>
<p>It's hard to troubleshooting problem with a simple error message which has no detail information. For example, the last time I encountered a "Failed to get session" exception, just the few words. I'm wondering which session is wrong? What is the reason Failed? It makes me crazy, the problem happens in an production environment and it's hard to reproduce. The exception should have some basic context information, such as author info, operation system, failed reason. The best exception information should be given a solution, such as the above: "From 10.20.16.3 to 10.20.130.20:20880 The network is unreachable. Please use telnet 10.20.130.20 20880 to test the network at 10.20.16.3. If it is called across data center, it may be blocked by the firewall. Please contact SA to grant access permission." etc. The above can even judge whether it is cross data center based on IP address. Another example is the spring-web context loading, If spring is not started when getBean, spring will report an error. The error message says: "Please add: <code>&lt;listener&gt;...&lt;init-param&gt;...</code>", just copy and paste.  We should learn from it. You can deliberately make a common mistake and see if you can solve the problem yourself by the error message. Or we can write some solution of common problems in error message.</p>
<h2 id="and-also-the-environment-information">And also the environment information</h2>
<p>Every time an application error occurs, the developer or QA will send the error message and ask the reason. At this time, I will ask some question again, which version is used? Is it a production environment or a development environment? Which registry center? Which project is it? Which machine? And which service? The problem is, some developers or QA can't tell the difference, it waste me a lot of time. So, it is best to log some environment information, we can make a wrapper. Decorate the Logger interface such as:</p>
<pre><code class="java">public void error(String msg, Throwable e) {  
    delegate.error(msg + &quot; on server &quot; + InetAddress.getLocalHost() + &quot; using version &quot; + Version.getVersion(), e);  
}  
</code></pre>

<p>Utility class for retrieve version：</p>
<pre><code class="java">public final class Version {  

    private Version() {}  

    private static final Logger logger = LoggerFactory.getLogger(Version.class);  

    private static final Pattern VERSION_PATTERN = Pattern.compile(&quot;([0-9][0-9\\.\\-]*)\\.jar&quot;);  

    private static final String VERSION = getVersion(Version.class, &quot;2.0.0&quot;);  

    public static String getVersion(){  
        return VERSION;  
    }  

    public static String getVersion(Class cls, String defaultVersion) {  
        try {  
            // search version number from MANIFEST.MF 
            String version = cls.getPackage().getImplementationVersion();  
            if (version == null || version.length() == 0) {  
                version = cls.getPackage().getSpecificationVersion();  
            }  
            if (version == null || version.length() == 0) {  
                // if not found, extract from jar name
                String file = cls.getProtectionDomain().getCodeSource().getLocation().getFile();  
                if (file != null &amp;amp;&amp;amp; file.length() &amp;gt; 0 &amp;amp;&amp;amp; file.endsWith(&quot;.jar&quot;)) {  
                    Matcher matcher = VERSION_PATTERN.matcher(file);  
                    while (matcher.find() &amp;amp;&amp;amp; matcher.groupCount() &amp;gt; 0) {  
                        version = matcher.group(1);  
                    }  
                }  
            }  
            // return version, return default if null
            return version == null || version.length() == 0 ? defaultVersion : version;  
        } catch (Throwable e) { 
            // ignore exception, return default version
            logger.error(e.getMessage(), e);  
            return defaultVersion;  
        }  
    }  

}
</code></pre>

<h2 id="dump-before-kill">Dump before kill</h2>
<p>Every time there is a problem with the production environment, everyone panics. Usually the most direct way is to rollback and restart, to reduce the downtime. So that the scene is destroyed, and it's hard to check the problem afterwards. Some problem is hard to reproduce in development environment and may happen under hard pressure. It is unlikely let the developer or Appops manually backup all the data before. Therefore, it is best to call dump before the kill script to backup automatically and avoid  mistake. Dump script for example:</p>
<pre><code class="sh">JAVA_HOME=/usr/java  
OUTPUT_HOME=~/output  
DEPLOY_HOME=`dirname $0`  
HOST_NAME=`hostname`  

DUMP_PIDS=`ps  --no-heading -C java -f --width 1000 | grep &quot;$DEPLOY_HOME&quot; |awk '{print $2}'`  
if [ -z &quot;$DUMP_PIDS&quot; ]; then  
    echo &quot;The server $HOST_NAME is not started!&quot;  
    exit 1;  
fi  

DUMP_ROOT=$OUTPUT_HOME/dump  
if [ ! -d $DUMP_ROOT ]; then  
    mkdir $DUMP_ROOT  
fi  

DUMP_DATE=`date +%Y%m%d%H%M%S`  
DUMP_DIR=$DUMP_ROOT/dump-$DUMP_DATE  
if [ ! -d $DUMP_DIR ]; then  
    mkdir $DUMP_DIR  
fi  

echo -e &quot;Dumping the server $HOST_NAME ...\c&quot;  
for PID in $DUMP_PIDS ; do  
    $JAVA_HOME/bin/jstack $PID &gt; $DUMP_DIR/jstack-$PID.dump 2&gt;&amp;1  
    echo -e &quot;.\c&quot;  
    $JAVA_HOME/bin/jinfo $PID &gt; $DUMP_DIR/jinfo-$PID.dump 2&gt;&amp;1  
    echo -e &quot;.\c&quot;  
    $JAVA_HOME/bin/jstat -gcutil $PID &gt; $DUMP_DIR/jstat-gcutil-$PID.dump 2&gt;&amp;1  
    echo -e &quot;.\c&quot;  
    $JAVA_HOME/bin/jstat -gccapacity $PID &gt; $DUMP_DIR/jstat-gccapacity-$PID.dump 2&gt;&amp;1  
    echo -e &quot;.\c&quot;  
    $JAVA_HOME/bin/jmap $PID &gt; $DUMP_DIR/jmap-$PID.dump 2&gt;&amp;1  
    echo -e &quot;.\c&quot;  
    $JAVA_HOME/bin/jmap -heap $PID &gt; $DUMP_DIR/jmap-heap-$PID.dump 2&gt;&amp;1  
    echo -e &quot;.\c&quot;  
    $JAVA_HOME/bin/jmap -histo $PID &gt; $DUMP_DIR/jmap-histo-$PID.dump 2&gt;&amp;1  
    echo -e &quot;.\c&quot;  
    if [ -r /usr/sbin/lsof ]; then  
    /usr/sbin/lsof -p $PID &gt; $DUMP_DIR/lsof-$PID.dump  
    echo -e &quot;.\c&quot;  
    fi  
done  
if [ -r /usr/bin/sar ]; then  
/usr/bin/sar &gt; $DUMP_DIR/sar.dump  
echo -e &quot;.\c&quot;  
fi  
if [ -r /usr/bin/uptime ]; then  
/usr/bin/uptime &gt; $DUMP_DIR/uptime.dump  
echo -e &quot;.\c&quot;  
fi  
if [ -r /usr/bin/free ]; then  
/usr/bin/free -t &gt; $DUMP_DIR/free.dump  
echo -e &quot;.\c&quot;  
fi  
if [ -r /usr/bin/vmstat ]; then  
/usr/bin/vmstat &gt; $DUMP_DIR/vmstat.dump  
echo -e &quot;.\c&quot;  
fi  
if [ -r /usr/bin/mpstat ]; then  
/usr/bin/mpstat &gt; $DUMP_DIR/mpstat.dump  
echo -e &quot;.\c&quot;  
fi  
if [ -r /usr/bin/iostat ]; then  
/usr/bin/iostat &gt; $DUMP_DIR/iostat.dump  
echo -e &quot;.\c&quot;  
fi  
if [ -r /bin/netstat ]; then  
/bin/netstat &gt; $DUMP_DIR/netstat.dump  
echo -e &quot;.\c&quot;  
fi  
echo &quot;OK!&quot;
</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
