<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>负载均衡 - Dubbo 3.0.0</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u8d1f\u8f7d\u5747\u8861";
    var mkdocs_page_input_path = "user/demos/loadbalance.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Dubbo 3.0.0</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">用户手册</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">入门</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/background/">背景</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/background/">需求</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/architecture/">架构</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../preface/usage/">用法</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../quick-start/">快速启动</a>
                </li>
                <li class="">
                    
    <a class="" href="../../dependencies/">依赖</a>
                </li>
                <li class="">
                    
    <a class="" href="../../maturity/">成熟度</a>
                </li>
                <li class="">
                    
    <span class="caption-text">配置</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/xml/">XML 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/api/">API 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/annotation/">Annotation 配置</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/annotation/">动态配置中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/configuration-load-process/">配置加载流程</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../configuration/environment-variables.md">自动加载环境变量</a>
                </li>
    </ul>
                </li>
                <li class=" current">
                    
    <span class="caption-text">示例</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../preflight-check/">启动时检查</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../fault-tolerent-strategy/">集群容错</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">负载均衡</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#loadbalance">LoadBalance</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#loadbalance-strategy">LoadBalance strategy</a></li>
        
            <li><a class="toctree-l5" href="#configuration">Configuration</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../thread-model/">线程模型</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../explicit-target/">直连提供者</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../subscribe-only/">只订阅</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../registry-only/">只注册</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../static-service/">静态服务</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../multi-protocols/">多协议</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../multi-registry/">多注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../service-group/">服务分组</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../multi-versions/">多版本</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../group-merger/">分组聚合</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../parameter-validation/">参数验证</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../result-cache/">结果缓存</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../generic-reference/">泛化引用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../generic-service/">泛化实现</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../echo-service/">回声测试</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../context/">上下文信息</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../attachment/">隐式参数</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../async-call/">异步调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../async-execute-on-provider/">服务端异步</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../local-call/">本地调用</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../callback-parameter/">参数回调</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../events-notify/">事件通知</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../local-stub/">本地存根</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../local-mock/">本地伪装</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../delay-publish/">延迟暴露</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../concurrency-control/">并发控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../config-connection.md">连接控制</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../lazy-connect/">延迟连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../stickiness/">粘滞连接</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../token-authorization/">令牌验证</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../routing-rule/">路由规则</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../config-rule/">配置规则</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../service-downgrade/">服务降级</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../graceful-shutdown/">优雅停机</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../hostname-binding/">主机绑定</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../logger-strategy/">日志适配</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../accesslog/">访问日志</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../service-container/">服务容器</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../distributed-transaction/">分布式事务</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../dump/">线程栈自动dump</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../netty4/">Netty4</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../serialization/">Kryo和FST序列化</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../simplify-registry-data.md">简化注册中心URL</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../api.md">API 参考手册</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">schema 配置参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-service/">dubbo:service</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-reference/">dubbo:reference</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-protocol/">dubbo:protocol</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-registry/">dubbo:registry</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-monitor/">dubbo:monitor</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-application/">dubbo:application</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-module/">dubbo:module</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-provider/">dubbo:provider</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-consumer/">dubbo:consumer</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-method/">dubbo:method</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-argument/">dubbo:argument</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-parameter/">dubbo:parameter</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/xml/dubbo-config-center/">dubbo:config-center</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">协议参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/dubbo/">dubbo://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/rmi/">rmi://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/hessian/">hessian://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/http/">http://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/thrift/">thrift://</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/protocol/rest/">rest://</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">注册中心参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/multicast/">Multicast 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/zookeeper/">Zookeeper 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/redis/">Redis 注册中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/simple/">Simple 注册中心</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">元数据中心参考手册</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../references/metadata/metadata-redis.md">Redis 元数据中心</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../references/registry/metadata-zookeeper.md">Zookeeper 元数据中心</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../references/telnet/">telnet 命令参考手册</a>
                </li>
                <li class="">
                    
    <a class="" href="../../references/qos/">在线运维命令-QOS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../references/maven/">maven 插件参考手册</a>
                </li>
                <li class="">
                    
    <a class="" href="../../best-practice/">服务化最佳实践</a>
                </li>
                <li class="">
                    
    <a class="" href="../../recommend/">推荐用法</a>
                </li>
                <li class="">
                    
    <a class="" href="../../capacity-plan/">容量规划</a>
                </li>
                <li class="">
                    
    <a class="" href="../../perf-test/">性能测试报告</a>
                </li>
                <li class="">
                    
    <a class="" href="../../covergence.md">测试覆盖率报告</a>
                </li>
                <li class="">
                    
    <span class="caption-text">版本与升级</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../version-270.md">2.7.x升级步骤及注意事项</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">管理者文档</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../dev/introduction/">Dubbo Admin介绍</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/serviceSearch.md">服务搜索和详情</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/serviceGovernance.md">服务治理</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../dev/serviceTest.md">服务测试</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Dubbo 3.0.0</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>示例 &raquo;</li>
        
      
        
          <li>用户手册 &raquo;</li>
        
      
    
    <li>负载均衡</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="loadbalance">LoadBalance</h1>
<p>Dubbo offers a number of balancing strategies for cluster load balancing, which defaults to <code>random</code>.</p>
<p>You can extend the load balancing strategy by yourself, see: <a href="../../../dev/impls/load-balance/">LoadBalance extension</a></p>
<h2 id="loadbalance-strategy">LoadBalance strategy</h2>
<h3 id="random-loadbalance">Random LoadBalance</h3>
<ul>
<li><strong>Ramdom</strong>, set random probabilities by weight.</li>
<li>The probability of collisions on one section is high, but the larger the amount of calls, the more uniform the distribution. And when use weight based on probability the distribution turns out to be uniform, which also helps to dynamically adjust the provider weights.</li>
</ul>
<h3 id="roundrobin-loadbalance">RoundRobin LoadBalance</h3>
<ul>
<li><strong>RoundRobin</strong>, use the weight's common advisor to determine round robin ratio.</li>
<li>Traffic flow to slower providers may cause requests piled up, e.g., if there's a provider processing requests in a very slow speed, but it's still alive, which means it can receive request as normal. According to RoundRobin policy, consumers will continuously send requests to this provider on predetermined pace, have no aware of the provider's bad status. Finally, we will get many requests stuck on this unhealthy provider.</li>
</ul>
<h3 id="leastactive-loadbalance">LeastActive LoadBalance</h3>
<ul>
<li><strong>LeastActive</strong>, a random mechanism based on actives, <code>actives</code> means the num of requests a consumer have sent but not return yet。</li>
<li>Slower providers will receive fewer requests, cause slower provider have higher <code>actives</code>.</li>
</ul>
<h3 id="consistenthash-loadbalance">ConsistentHash LoadBalance</h3>
<ul>
<li><strong>ConsistentHash</strong>, the same parameters of the request is always sent to the same provider.</li>
<li>When a provider fails, the original request to the provider, based on the virtual node algorithm, averages to other providers, does not cause drastic changes.</li>
<li>Algorithm reference：http://en.wikipedia.org/wiki/Consistent_hashing</li>
<li>By default only the first parameter Hash, if you want to modify, please configure <code>&lt;dubbo:parameter key="hash.arguments" value="0,1" /&gt;</code></li>
<li>By default 160 virtual nodes, if you want to modify, please configure <code>&lt;dubbo:parameter key="hash.nodes" value="320" /&gt;</code></li>
</ul>
<p>See the algorithm at http://en.wikipedia.org/wiki/Consistent_hashing</p>
<h2 id="configuration">Configuration</h2>
<h3 id="server-service-level">Server service level</h3>
<pre><code class="xml">&lt;dubbo:service interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;
</code></pre>

<h3 id="client-service-level">Client service level</h3>
<pre><code class="xml">&lt;dubbo:reference interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;
</code></pre>

<h3 id="server-method-level">Server method level</h3>
<pre><code class="xml">&lt;dubbo:service interface=&quot;...&quot;&gt;
    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;
&lt;/dubbo:service&gt;
</code></pre>

<h3 id="client-method-level">Client method level</h3>
<pre><code class="xml">&lt;dubbo:reference interface=&quot;...&quot;&gt;
    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;
&lt;/dubbo:reference&gt;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../thread-model/" class="btn btn-neutral float-right" title="线程模型">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../fault-tolerent-strategy/" class="btn btn-neutral" title="集群容错"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../fault-tolerent-strategy/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../thread-model/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
